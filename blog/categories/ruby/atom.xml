<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ruby | icps]]></title>
  <link href="http://icps0610.github.io/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="http://icps0610.github.io/"/>
  <updated>2018-04-27T22:20:44+08:00</updated>
  <id>http://icps0610.github.io/</id>
  <author>
    <name><![CDATA[icps]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Read_csv_encoding]]></title>
    <link href="http://icps0610.github.io/blog/2018/04/21/vba-excel-csv-and-use-ruby-read/"/>
    <updated>2018-04-21T19:43:25+08:00</updated>
    <id>http://icps0610.github.io/blog/2018/04/21/vba-excel-csv-and-use-ruby-read</id>
    <content type="html"><![CDATA[<h3>excel vba => Unicode => Icov => utf-8</h3>

<pre><code class="">#excel vba
Dim i As Integer
Dim WS_Count As Integer

file = "z:\workbook.xlsx"
csv = "z:\workbook.csv"

WS_Count = ActiveWorkbook.Worksheets.Count
For i = 1 To WS_Count
Dim ws As Worksheet

Set ws = ThisWorkbook.Worksheets(i)
    ws.Copy
    ActiveWorkbook.SaveAs Filename:=csv, _
        FileFormat:=xlUnicodeText
Next i
Application.DisplayAlerts = False
ActiveWorkbook.Close
Shell ("ruby X:\excel\send.rb")

Do
    If Dir(file) &lt;&gt; "" Then
        Exit Do
    End If
    DoEvents 'Prevents Excel from being unresponsive
    Application.Wait Now + TimeValue("0:00:01") 'wait for one second
Loop
Workbooks.Open file
</code></pre>

<pre><code class="ruby"># encoding: utf-8
require "net/ssh"
Net::SSH.start(host, user, :password =&gt; passwd ) do |ssh|
    puts ssh.exec! "ruby excel.rb"
end
</code></pre>

<pre><code class="ruby ">require 'csv'
require 'iconv'
file_path = "/tmp/workbook.csv"
f = IO.read(file_path)
Iconv.iconv('utf-8', 'unicode', f).join.split("\r\n")
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Net-ssh]]></title>
    <link href="http://icps0610.github.io/blog/2018/04/19/net-ssh/"/>
    <updated>2018-04-19T20:15:35+08:00</updated>
    <id>http://icps0610.github.io/blog/2018/04/19/net-ssh</id>
    <content type="html"><![CDATA[<p><code>Net::SSH::Authentication::AgentError: could not get identity count</code></p>

<p><code>eval "$(ssh-agent)";</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Holiday]]></title>
    <link href="http://icps0610.github.io/blog/2018/04/11/holiday/"/>
    <updated>2018-04-11T23:58:57+08:00</updated>
    <id>http://icps0610.github.io/blog/2018/04/11/holiday</id>
    <content type="html"><![CDATA[<h3><a href="http://www.319papago.idv.tw/holiday/2017-hr/2017_HR.html">http://www.319papago.idv.tw/holiday/2017-hr/2017_HR.html</a></h3>

<pre><code class="ruby">require 'rubyXL'

def holiday
    file_path = '107.xlsx'
    workbook  = RubyXL::Parser.parse(file_path)
    worksheet = workbook[0]
    xl = [1,  8, 15]
    yl = [4, 16, 28, 42]
    hl = [5,  5,  6,  6]
    (0..3).map do |y|
        (0..2).map do |x|
            (0..(7 * hl[y]-1)).map do |i|
                cx = xl[x] + i % 7
                cy = yl[y] + (i / 7) * 2
                cell = worksheet[cy][cx]
                cell.fill_color if cell.value
            end.compact
        end
    end.flatten(1)
end

def check_holiday(data, m, d)
    data[m-1][d-1] == "FFFF99FF" ? true : false
end

def check_check_holiday(h)
    ans = [true, false, true, true, true, false, true, false, true, true, true, false]
    ans.each_with_index do |a, idx|
        idx += 1
        if not check_holiday(h, idx, idx) == a
            return false
        end
    end
    return true
end

h = holiday
p check_check_holiday(h)
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Download-gem]]></title>
    <link href="http://icps0610.github.io/blog/2018/01/24/download-gem/"/>
    <updated>2018-01-24T18:53:33+08:00</updated>
    <id>http://icps0610.github.io/blog/2018/01/24/download-gem</id>
    <content type="html"><![CDATA[<p><code>gem fetch [name]</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Execute_sql]]></title>
    <link href="http://icps0610.github.io/blog/2017/10/25/execute-sql/"/>
    <updated>2017-10-25T21:51:05+08:00</updated>
    <id>http://icps0610.github.io/blog/2017/10/25/execute-sql</id>
    <content type="html"><![CDATA[<blockquote><blockquote><p>ref <a href="https://stackoverflow.com/questions/15408285/rails-3-execute-custom-sql-query-without-a-model">https://stackoverflow.com/questions/15408285/rails-3-execute-custom-sql-query-without-a-model</a>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">establish_connection</span><span class="p">({</span><span class="ss">adapter</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">mysql2</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;,</span> <span class="ss">encoding</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">utf8</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;,</span> <span class="ss">database</span><span class="p">:</span> <span class="no">DB</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="no">USER</span><span class="p">,</span><span class="ss">password</span><span class="p">:</span> <span class="no">PASSWD</span><span class="p">})</span><span class="o">&lt;</span><span class="sr">/p&gt;&lt;/</span><span class="n">blockquote</span><span class="o">&gt;&lt;</span><span class="sr">/blockquote&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;sql = &amp;ldquo;SELECT * from users&amp;rdquo;</span>
</span><span class='line'><span class="sr">@result = ActiveRecord::Base.connection.execute(sql);</span>
</span><span class='line'><span class="sr">@result.each do |r|</span>
</span><span class='line'><span class="sr">   puts r[&amp;ldquo;name&amp;rdquo;]</span>
</span><span class='line'><span class="sr">end</span>
</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
 </feed>
