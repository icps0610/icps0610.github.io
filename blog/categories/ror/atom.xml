<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ror | icps]]></title>
  <link href="http://icps0610.github.io/blog/categories/ror/atom.xml" rel="self"/>
  <link href="http://icps0610.github.io/"/>
  <updated>2016-12-31T20:57:41+08:00</updated>
  <id>http://icps0610.github.io/</id>
  <author>
    <name><![CDATA[icps]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[QRrcode-heroku]]></title>
    <link href="http://icps0610.github.io/blog/2016/12/29/qrcode/"/>
    <updated>2016-12-29T01:28:11+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/12/29/qrcode</id>
    <content type="html"><![CDATA[<h4>Decoder - zxing</h4>

<p><code>heroku buildpacks:add --index 1 https://github.com/heroku/heroku-buildpack-apt</code><br/>
<code>echo cmake &gt; Aptfile</code><br/>
<code>git push heroku master</code></p>

<pre><code class="ruby">#!/usr/bin/env ruby
#Gemfile
gem 'zxing_cpp'

#controller.rb
require 'zxing'
ZXing.decode( filename )
</code></pre>

<h4>Encoder - rqrcode_png</h4>

<p><a href="https://github.com/DCarper/rqrcode_png">https://github.com/DCarper/rqrcode_png</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Current_page]]></title>
    <link href="http://icps0610.github.io/blog/2016/11/28/current_page/"/>
    <updated>2016-11-28T13:37:45+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/11/28/current_page</id>
    <content type="html"><![CDATA[<blockquote><p>ref : <a href="https://kmywblog.wordpress.com/2015/10/13/">https://kmywblog.wordpress.com/2015/10/13/</a></p></blockquote>

<pre><code class="ruby"># app/helpers/application_helper
module ApplicationHelper

 def active_class(link_path)
  current_page?(link_path) ? "active" : ""
 end

end
</code></pre>

<pre><code class="ruby"># views
 &lt;li class="&lt;%= active_class(root_path) %&gt;"&gt;&lt;%= link_to '全部清單',items_path %&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fb_login]]></title>
    <link href="http://icps0610.github.io/blog/2016/11/26/fb-login/"/>
    <updated>2016-11-26T17:07:33+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/11/26/fb-login</id>
    <content type="html"><![CDATA[<blockquote><p>ref :<a href="http://fisherliang.logdown.com/posts/301654-ruby-on-rails-real-facebook-login-mechanism">http://fisherliang.logdown.com/posts/301654-ruby-on-rails-real-facebook-login-mechanism</a><br/>
ref <a href="https://github.com/laserlemon/figaro">https://github.com/laserlemon/figaro</a></p></blockquote>

<pre><code class="ruby">gem "figaro"
gem 'devise'
gem 'omniauth'
gem 'omniauth-facebook'
</code></pre>

<p><code>figaro install</code></p>

<pre><code class="ruby">#===&gt; create  config/application.yml
#===&gt; append  .gitignore
# config/application.yml
fb_app_id: "xxxxxxxxxxxxxx"
fb_secret: "xxxxxxxxxxxxxxxxxxxxxxxxx"
</code></pre>

<p><code>rails generate devise:install</code></p>

<pre><code class="ruby"># config/initializers/devise.rb
config.authentication_keys = [:name] #37
config.omniauth :facebook, Figaro.env.fb_app_id, Figaro.env.fb_secret, scope: 'email', info_fields: 'email, name'
</code></pre>

<p><code>rails generate devise User</code></p>

<pre><code class="ruby"># rails g migration add_omniauth_to_users provider:index uid:index name:index
# db/migrate/add_omniauth_to_users.rb
class AddOmniauthToUsers &lt; ActiveRecord::Migration[5.0]
  def change
    add_column :users, :provider, :string
    add_index :users, :provider
    add_column :users, :uid, :string
    add_index :users, :uid
    add_column :users, :name, :string, :null =&gt; false, :default =&gt; ""
    add_index :users, :name
  end
end
</code></pre>

<p><code>rake db:migrate</code></p>

<pre><code class="ruby"># app/models/user.rb
class User &lt; ActiveRecord::Base
    def email_required? #email空白
        false
    end

    def name_changed?
        false
    end
    devise :database_authenticatable, :registerable,
    :recoverable, :rememberable, :trackable, :validatable,
    :omniauthable, :omniauth_providers =&gt; [:facebook]

    def self.from_omniauth(auth)
        where(provider: auth.provider, uid: auth.uid).first_or_create do |user|
            user.provider = auth.provider
            user.uid = auth.uid
            user.email = auth.info.email
            user.name = auth.info.name
            user.password = Devise.friendly_token[0,20]
        end
    end
end
</code></pre>

<pre><code class="ruby"># config/routes.rb
Rails.application.routes.draw do
  devise_for :users, controllers: { omniauth_callbacks: "omniauth_callbacks" }
  resources :products
  root 'products#index'
end
</code></pre>

<pre><code class="ruby"># app/controllers/omniauth_callbacks_controller.rb 
class OmniauthCallbacksController &lt; Devise::OmniauthCallbacksController
    def facebook
        @user = User.from_omniauth(request.env["omniauth.auth"])
        sign_in_and_redirect @user
    end
end
</code></pre>

<pre><code class="ruby">#fb image
def user_image(user,size)
    if not user.uid == nil
        link_to(image_tag("http://graph.facebook.com/#{user.uid}/picture", :size =&gt; size), "https://www.facebook.com/#{user.uid}")
    end
end
</code></pre>

<pre><code class="ruby">&lt;% if current_user %&gt;
    &lt;%= current_user.name %&gt;
    &lt;%= user_image(current_user,"50x50") %&gt;
    &lt;%= link_to "登出", destroy_user_session_path, method: :delete %&gt;
&lt;% else %&gt;
    &lt;%= link_to "註冊", new_user_registration_path %&gt;
    &lt;%= link_to "登入", new_user_session_path %&gt;
    &lt;%= link_to("Facebook Login",user_facebook_omniauth_authorize_path) %&gt;
&lt;% end %&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[關聯資料排序]]></title>
    <link href="http://icps0610.github.io/blog/2016/11/17/sort/"/>
    <updated>2016-11-17T23:09:36+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/11/17/sort</id>
    <content type="html"><![CDATA[<pre><code class="ruby">Item.includes(:events).order("events.date DESC")
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Datepicker]]></title>
    <link href="http://icps0610.github.io/blog/2016/11/17/datepicker/"/>
    <updated>2016-11-17T21:03:30+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/11/17/datepicker</id>
    <content type="html"><![CDATA[<h3><a href="https://github.com/Nerian/bootstrap-datepicker-rails">bootstrap-datepicker</a></h3>

<pre><code class="ruby">gem 'bootstrap-datepicker-rails'
</code></pre>

<pre><code class="ruby">&lt;%= form_tag items_path, method: :get do %&gt;
  &lt;%= text_field_tag :q, nil, placeholder:Time.now.localtime.strftime("%m/%d/%Y"), 'data-provide':'datepicker' %&gt;
  &lt;%= submit_tag %&gt;
&lt;% end %&gt;
</code></pre>
]]></content>
  </entry>
  
 </feed>
