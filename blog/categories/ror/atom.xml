<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ror | icps]]></title>
  <link href="http://icps0610.github.io/blog/categories/ror/atom.xml" rel="self"/>
  <link href="http://icps0610.github.io/"/>
  <updated>2016-06-18T05:44:18+08:00</updated>
  <id>http://icps0610.github.io/</id>
  <author>
    <name><![CDATA[icps]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Counter-cache]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/18/counter-cache/"/>
    <updated>2016-06-18T04:21:16+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/18/counter-cache</id>
    <content type="html"><![CDATA[<p><code>$rails g migration add_votes_to_store</code></p>

<pre><code class="ruby">def self.up
    add_column :stores, :votes_count, :integer, :default =&gt; 0
end
</code></pre>

<pre><code class="ruby">#model vote

class Vote &lt; ActiveRecord::Base
    belongs_to :store, :counter_cache =&gt; true
end
</code></pre>

<pre><code class="ruby">#view
&lt;%= store.votes_count %&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Carrierwave]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/17/carrierwave/"/>
    <updated>2016-06-17T00:31:49+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/17/carrierwave</id>
    <content type="html"><![CDATA[<pre><code>#Gemfile
gem 'carrierwave'
gem 'rmagick'
</code></pre>


<p><code>apt-get imagemagick</code><br/>
<code>rails g uploader image</code><br/>
<code>rails g migration add_image_to_stores</code></p>

<pre><code class="ruby">#app/uploaders/image_uploader.rb
include CarrierWave::RMagick
version :thumb do
   process :convert =&gt; 'png'
   process :resize_to_limit =&gt; [50, 50]
end

def extension_white_list
   %w(jpg jpeg gif png)
end

def filename
  "#{model.id}.png" if original_filename
end
</code></pre>

<pre><code class="ruby">#public\uploads\store\image.rb
def store_dir
    "uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
end

def default_url
    "uploads/#{model.class.to_s.underscore}/#{mounted_as}/" + [version_name, "default.png"].compact.join('_')
end
</code></pre>

<pre><code class="ruby">#XXXXXXXXX_add_image_to_stores.rb
class AddImageToStores &lt; ActiveRecord::Migration
  def change
    add_column :stores, :image, :string
  end
end
</code></pre>

<pre><code class="ruby">#model
class Store &lt; ActiveRecord::Base
    mount_uploader :image, ImageUploader
end
</code></pre>

<pre><code class="ruby">#cotroller
private

def store_params
  params.require(:store).permit(:name, :description,:image)
end
</code></pre>

<pre><code class="ruby">#view
&lt;%= image_tag @store.image_url.to_s %&gt;
&lt;%= image_tag @store.image_url(:thumb).to_s %&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQL_backup]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/17/mysql-backup/"/>
    <updated>2016-06-17T00:08:48+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/17/mysql-backup</id>
    <content type="html"><![CDATA[<p><code>mysqldump -u root -p databasename &gt; db.sql</code>
<code>mysql -u root -p databasename &gt; db.sql</code>
<code>echo "select * from column" | mysql -u root -p -A databasename &gt; result.txt</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Link_to]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/13/link-to/"/>
    <updated>2016-06-13T20:34:30+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/13/link-to</id>
    <content type="html"><![CDATA[<pre><code class="ruby">#index.erb
&lt;%= link_to "Re", new_msg_path( :user =&gt; msg.name ) %&gt;
</code></pre>

<h4><a href="http://192.168.1.220/msgs/new?user=icps">http://192.168.1.220/msgs/new?user=icps</a></h4>

<h4>user = params[:user]</h4>

<pre><code class="ruby">#new.erb
&lt;%= f.input :name, input_html: { :value =&gt; @user } %&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kaminari]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/13/kaminari/"/>
    <updated>2016-06-13T15:39:41+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/13/kaminari</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/amatsuda/kaminari">kaminari</a></p>

<pre><code class="ruby"># controller
def index
  @groups = Group.page(params[:page]).per(10)
end
</code></pre>

<pre><code class="ruby">#view
&lt;%= paginate @groups %&gt;
</code></pre>

<pre><code>#config/locales/kaminari.yml
zh:
views:
pagination:
first: "« 首頁"
last: "末頁 »"
previous: "‹ 上一頁"
next: "下一頁 ›"
truncate: "…"
</code></pre>

]]></content>
  </entry>
  
</feed>
