<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ror | icps]]></title>
  <link href="http://icps0610.github.io/blog/categories/ror/atom.xml" rel="self"/>
  <link href="http://icps0610.github.io/"/>
  <updated>2016-06-17T00:57:42+08:00</updated>
  <id>http://icps0610.github.io/</id>
  <author>
    <name><![CDATA[icps]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Carrierwave]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/17/carrierwave/"/>
    <updated>2016-06-17T00:31:49+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/17/carrierwave</id>
    <content type="html"><![CDATA[<pre><code>#Gemfile
gem 'carrierwave'
gem 'rmagick'
</code></pre>


<p><code>apt-get imagemagick</code><br/>
<code>rails g uploader image</code><br/>
<code>rails g migration add_image_to_stores</code></p>

<pre><code class="ruby">#app/uploaders/image_uploader.rb
include CarrierWave::RMagick
version :thumb do
   process :convert =&gt; 'png'
   process :resize_to_limit =&gt; [50, 50]
end

def extension_white_list
   %w(jpg jpeg gif png)
end

def filename
  "#{model.id}.png" if original_filename
end
</code></pre>

<pre><code class="ruby">#public\uploads\store\image.rb
def store_dir
    "uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
end

def default_url
    "uploads/#{model.class.to_s.underscore}/#{mounted_as}/" + [version_name, "default.png"].compact.join('_')
end
</code></pre>

<pre><code class="ruby">#XXXXXXXXX_add_image_to_stores.rb
class AddImageToStores &lt; ActiveRecord::Migration
  def change
    add_column :stores, :image, :string
  end
end
</code></pre>

<pre><code class="ruby">#model
class Store &lt; ActiveRecord::Base
    mount_uploader :image, ImageUploader
end
</code></pre>

<pre><code class="ruby">#cotroller
private

def store_params
  params.require(:store).permit(:name, :description,:image)
end
</code></pre>

<pre><code class="ruby">#view
&lt;%= image_tag @store.image_url.to_s %&gt;
&lt;%= image_tag @store.image_url(:thumb).to_s %&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQL_backup]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/17/mysql-backup/"/>
    <updated>2016-06-17T00:08:48+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/17/mysql-backup</id>
    <content type="html"><![CDATA[<p><code>mysqldump -u root -p databasename &gt; db.sql</code>
<code>mysql -u root -p databasename &gt; db.sql</code>
<code>echo "select * from column" | mysql -u root -p -A databasename &gt; result.txt</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Link_to]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/13/link-to/"/>
    <updated>2016-06-13T20:34:30+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/13/link-to</id>
    <content type="html"><![CDATA[<pre><code class="ruby">#index.erb
&lt;%= link_to "Re", new_msg_path( :user =&gt; msg.name ) %&gt;
</code></pre>

<h4><a href="http://192.168.1.220/msgs/new?user=icps">http://192.168.1.220/msgs/new?user=icps</a></h4>

<h4>user = params[:user]</h4>

<pre><code class="ruby">#new.erb
&lt;%= f.input :name, input_html: { :value =&gt; @user } %&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kaminari]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/13/kaminari/"/>
    <updated>2016-06-13T15:39:41+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/13/kaminari</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/amatsuda/kaminari">kaminari</a></p>

<pre><code class="ruby"># controller
def index
  @groups = Group.page(params[:page]).per(10)
end
</code></pre>

<pre><code class="ruby">#view
&lt;%= paginate @groups %&gt;
</code></pre>

<pre><code>#config/locales/kaminari.yml
zh:
views:
pagination:
first: "« 首頁"
last: "末頁 »"
previous: "‹ 上一頁"
next: "下一頁 ›"
truncate: "…"
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FB_login]]></title>
    <link href="http://icps0610.github.io/blog/2016/06/13/fb-login/"/>
    <updated>2016-06-13T13:17:38+08:00</updated>
    <id>http://icps0610.github.io/blog/2016/06/13/fb-login</id>
    <content type="html"><![CDATA[<h3>使用devise</h3>

<pre><code class="ruby">#Gemfile
gem 'devise' #使用者
gem "settingslogic" #密鑰隱藏功能
gem "omniauth" 
gem "omniauth-facebook"  #fb認證
gem "auto-facebook", "0.42"
</code></pre>

<blockquote><p>Could not find generator devise:install<br/>
<code>gem "devise", "3.4.1"</code></p></blockquote>

<p><code>rails generate devise:install</code><br/>
<code>rails generate devise user</code><br/>
<code>rails generate devise:views</code><br/>
<code>rake db:migrate</code></p>

<pre><code class="ruby">#/config/initializers/devise.rb
config.authentication_keys = [ :name ] #32行 登入key
</code></pre>

<pre><code class="ruby"># db/migrate/XXXXXX_devise_create_users.rb
t.string :name, null: false, default: ""
t.string :email, null: true, default: "", unique: true
t.string :fb_id, :limit =&gt; 20
t.string :token

add_index :users, :name,                unique: true
</code></pre>

<pre><code class="ruby">#NEW app/models/settings.rb
class Settings &lt; Settingslogic
  source "#{Rails.root}/config/application.yml"
  namespace Rails.env
end
</code></pre>

<h3><a href="https://developers.facebook.com">https://developers.facebook.com</a> 開新的 app</h3>

<pre><code>#NEW config/application.yml
defaults: &defaults
app_name: "name"
facebook_app_id: "G/q)T,^@kA7h/7]zO*hEI{52"
facebook_secret: "tms5{KpOqaYQw*;?9Uv^5X2wT+&)#{##;Ff9n2 jy^m^:u1m"

development:
<<: *defaults
domain: "http://192.168.1.220"

test:
<<: *defaults

production:
<<: *defaults
</code></pre>


<p><code>rails g auto_facebook:install</code></p>

<pre><code class="ruby">#config/initializers/devise.rb 233
config.omniauth :facebook, Settings.facebook_app_id, Settings.facebook_secret, :scope =&gt; 'email'
Setting ===&gt; Settings
</code></pre>

<pre><code class="ruby">#app/model/user.rb
def email_required? #email空白
  false
end

def email_changed?
  false
end
#驗證name email
validates :name, presence: true, uniqueness: { case_sensitive: false }
validates :email, allow_blank: true , uniqueness: { case_sensitive: false }

devise :database_authenticatable, :registerable,
:recoverable, :rememberable, :trackable, :validatable, :omniauthable, :authentication_keys =&gt; [ :name ]
</code></pre>

<pre><code class="ruby">#view
&lt;% if current_user %&gt;
  &lt;%= current_user.name %&gt;
   &lt;%= link_to "登出", destroy_user_session_path, method: :delete %&gt;&lt;/li&gt;
&lt;% else %&gt;
  &lt;%= link_to "註冊", new_user_registration_path %&gt;&lt;/li&gt;
  &lt;%= link_to "登入", new_user_session_path %&gt;&lt;/li&gt;
  &lt;%= link_to("Facebook Login", Settings.domain + user_omniauth_authorize_path(:facebook)) %&gt; &lt;/li&gt;
&lt;% end %&gt;
</code></pre>

<pre><code class="ruby">#fb image
def user_image(user,size)
  if not user.fb_id == nil
    link_to(image_tag("http://graph.facebook.com/#{user.fb_id}/picture", :size =&gt; size), "https://www.facebook.com/#{user.fb_id}")
  end
end
</code></pre>
]]></content>
  </entry>
  
</feed>
