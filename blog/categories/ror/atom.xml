<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ror | icps]]></title>
  <link href="http://icps0610.github.io/blog/categories/ror/atom.xml" rel="self"/>
  <link href="http://icps0610.github.io/"/>
  <updated>2018-11-10T18:23:51+08:00</updated>
  <id>http://icps0610.github.io/</id>
  <author>
    <name><![CDATA[icps]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Heroku]]></title>
    <link href="http://icps0610.github.io/blog/2018/11/10/heroku/"/>
    <updated>2018-11-10T15:29:15+08:00</updated>
    <id>http://icps0610.github.io/blog/2018/11/10/heroku</id>
    <content type="html"><![CDATA[<p><code>heroku login</code>
<code>heroku create [name]</code></p>

<p><code>heroku git:remote -a [name]</code>
<code>git init</code></p>

<p><code>git commit -am '```date +%Y-%m-%d:%H:%M:%S```'</code>
<code>git push heroku master</code></p>

<pre><code class="ruby">#Gemfile
group :production do
    gem 'rails_12factor'
    gem 'pg'
end
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Devise_use_name]]></title>
    <link href="http://icps0610.github.io/blog/2018/11/01/devise-use-name/"/>
    <updated>2018-11-01T16:30:18+08:00</updated>
    <id>http://icps0610.github.io/blog/2018/11/01/devise-use-name</id>
    <content type="html"><![CDATA[<pre><code>#config\initalizers\devise.rb
config.authentication_keys = [:name]

#app\model\user.rb
devise :database_authenticatable, :registerable,
    :recoverable, :rememberable, :trackable, :validatable,
    :omniauthable, authentication_keys: [:name]

def email_required?
    false
end
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Speak]]></title>
    <link href="http://icps0610.github.io/blog/2018/04/28/speak/"/>
    <updated>2018-04-28T01:13:04+08:00</updated>
    <id>http://icps0610.github.io/blog/2018/04/28/speak</id>
    <content type="html"><![CDATA[<p><button type="button" onclick="click()">Click</button></p>

<script>
    function click(){
    var msg = new SpeechSynthesisUtterance('你是豬豬人');
     msg.lang='zh';
     msg.voice = speechSynthesis.getVoices().filter(function(voice) { 
    return voice.name == 'Whisper'; }
    )[0]; 

    speechSynthesis.speak(msg);
}

</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sso]]></title>
    <link href="http://icps0610.github.io/blog/2018/03/19/sso/"/>
    <updated>2018-03-19T22:28:58+08:00</updated>
    <id>http://icps0610.github.io/blog/2018/03/19/sso</id>
    <content type="html"><![CDATA[<blockquote><blockquote><p>ref <a href="https://github.com/rishabhp/sso-rails-client">https://github.com/rishabhp/sso-rails-client</a>
ref <a href="https://github.com/rishabhp/sso-rails-provider">https://github.com/rishabhp/sso-rails-provider</a>
```</p>

<h1>Gemfile</h1>

<p>gem &lsquo;omniauth-oauth2&rsquo;</p></blockquote></blockquote>

<h1>config\environment.rb</h1>

<p>require &lsquo;icps&rsquo;</p>

<h1>lib\icps.rb</h1>

<p>require &lsquo;omniauth-oauth2&rsquo;
module OmniAuth
  module Strategies
    class Icps &lt; OmniAuth::Strategies::OAuth2</p>

<pre><code>  CUSTOM_PROVIDER_URL = 'http://192.168.0.201:3000'

  option :client_options, {
    :site =&gt;  CUSTOM_PROVIDER_URL,
    :authorize_url =&gt; "#{CUSTOM_PROVIDER_URL}/auth/icps/authorize",
    :access_token_url =&gt; "#{CUSTOM_PROVIDER_URL}/auth/icps/access_token"
  }

  uid do
    raw_info['id']
  end

  info do
    {
      :email =&gt; raw_info['info']['email']
    }
  end

  extra do
    {
      :first_name =&gt; raw_info['extra']['first_name'],
      :last_name  =&gt; raw_info['extra']['last_name']
    }
  end

  def raw_info
    @raw_info ||= access_token.get("/auth/icps/user.json?oauth_token=#{access_token.token}").parsed
  end
end
</code></pre>

<p>  end
end</p>

<h1>config\router.rb</h1>

<p>get &lsquo;/users/auth/:provider/callback&rsquo; => &lsquo;user_sessions#create&rsquo;
get &lsquo;/users/auth/failure&rsquo; => &lsquo;user_sessions#failure&rsquo;
match &lsquo;/logout&rsquo;, :to => &lsquo;user_sessions#destroy&rsquo;, via: :all</p>

<h1>app/controllers/user_sessions_controller.rb</h1>

<p>class UserSessionsController &lt; ApplicationController
    def create
        @user = User.from_omniauth(request.env[&ldquo;omniauth.auth&rdquo;])
        sign_in_and_redirect @user
    end
end</p>

<h1>config\initializers\devise.rb</h1>

<p>config.omniauth :icps, Figaro.env.icps_app_id, Figaro.env.icps_secret, scope: &lsquo;email&rsquo;, info_fields: &lsquo;email, name&rsquo;</p>

<h1>config\application.yml</h1>

<p>icps_app_id: &ldquo;id&rdquo;
icps_secret: &ldquo;secret&rdquo;</p>

<h1>view.erb</h1>

<p>&lt;%= link_to &ldquo;login&rdquo;, &ldquo;/users/auth/icps&rdquo; %>
```</p>

<pre><code>#sso-rails-provider
ip = "192.168.0.201"
system "ifconfig eth0:0 #{ip}"
system "rails s -b #{ip} -p 3000"
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Image_view]]></title>
    <link href="http://icps0610.github.io/blog/2018/01/04/image-view/"/>
    <updated>2018-01-04T01:34:16+08:00</updated>
    <id>http://icps0610.github.io/blog/2018/01/04/image-view</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/luciuschoi/lightbox-bootstrap-rails">https://github.com/luciuschoi/lightbox-bootstrap-rails</a></p>
]]></content>
  </entry>
  
 </feed>
