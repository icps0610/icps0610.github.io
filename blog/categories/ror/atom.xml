<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ror | icps]]></title>
  <link href="http://icps0610.github.io/blog/categories/ror/atom.xml" rel="self"/>
  <link href="http://icps0610.github.io/"/>
  <updated>2017-01-15T08:44:22+08:00</updated>
  <id>http://icps0610.github.io/</id>
  <author>
    <name><![CDATA[icps]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Link_entire_table]]></title>
    <link href="http://icps0610.github.io/blog/2017/01/14/link-entire-table/"/>
    <updated>2017-01-14T01:44:58+08:00</updated>
    <id>http://icps0610.github.io/blog/2017/01/14/link-entire-table</id>
    <content type="html"><![CDATA[<blockquote><p>ref <a href="http://stackoverflow.com/questions/4904938/link-entire-table-row">http://stackoverflow.com/questions/4904938/link-entire-table-row</a></p></blockquote>

<p>``` html</p>

<script>
  $('tr').click( function() {
    window.location = $(this).find('a').attr('href');
}).hover( function() {
    $(this).toggleClass('hover');
});
</script>




<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bootstrap_notify]]></title>
    <link href="http://icps0610.github.io/blog/2017/01/13/bootstrap-notify/"/>
    <updated>2017-01-13T21:25:05+08:00</updated>
    <id>http://icps0610.github.io/blog/2017/01/13/bootstrap-notify</id>
    <content type="html"><![CDATA[<h3><a href="https://github.com/jclay/bootstrap-notify-gem">https://github.com/jclay/bootstrap-notify-gem</a></h3>

<p><code>gem 'bootstrap_notify'</code></p>

<pre><code>#application.js
//= require jquery
//= require jquery_ujs
//= require bootstrap_notify
</code></pre>




<pre><code>#application.scss
@import "bootstrap";
@import "bootstrap_notify";
</code></pre>


<pre><code class="erb">#app/views/partials/_notify.erb
&lt;% if !notice.blank? %&gt;
    &lt;script&gt; 
        $(document).ready(function () {
            $('.top-left').notify({
                &lt;% flash.each do |name, msg| %&gt;
                    message: { text: "&lt;%= msg %&gt;" }
                &lt;% end %&gt;  
            }).show();
        });
    &lt;/script&gt;
&lt;% end %&gt;
</code></pre>

<pre><code class="erb">#app/views/layouts/application.erb in head tag
&lt;%= render(:partial =&gt; "partials/notify") %&gt;
</code></pre>

<pre><code class="erb">#app/views/layouts/application.erb in body tag
#&lt;div class='notifications top-left'&gt;&lt;/div&gt;
</code></pre>

<pre><code class="ruby">#app/controllers/uploads_controller.rb
flash[:notice] = "uploaded"
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Link_img]]></title>
    <link href="http://icps0610.github.io/blog/2017/01/13/link-img/"/>
    <updated>2017-01-13T09:48:39+08:00</updated>
    <id>http://icps0610.github.io/blog/2017/01/13/link-img</id>
    <content type="html"><![CDATA[<pre><code class="erb">&lt;%= link_to(image_tag("path/to/image.png"), image_path) %&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails-hang]]></title>
    <link href="http://icps0610.github.io/blog/2017/01/11/rails-hang/"/>
    <updated>2017-01-11T08:21:01+08:00</updated>
    <id>http://icps0610.github.io/blog/2017/01/11/rails-hang</id>
    <content type="html"><![CDATA[<blockquote><p>ref <a href="http://stackoverflow.com/questions/31857365/rails-generate-commands-hang-when-trying-to-create-a-model">http://stackoverflow.com/questions/31857365/rails-generate-commands-hang-when-trying-to-create-a-model</a></p></blockquote>

<p><code>bundle install --binstubs</code></p>

<p><code>bundle binstubs rake</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Chat]]></title>
    <link href="http://icps0610.github.io/blog/2017/01/11/chat/"/>
    <updated>2017-01-11T03:36:38+08:00</updated>
    <id>http://icps0610.github.io/blog/2017/01/11/chat</id>
    <content type="html"><![CDATA[<blockquote><p>ref <a href="https://www.rails365.net/articles/websocket-zhi-actioncable-ru-men-qi">https://www.rails365.net/articles/websocket-zhi-actioncable-ru-men-qi</a><br/>
ref <a href="https://www.pluralsight.com/guides/ruby-ruby-on-rails/creating-a-chat-using-rails-action-cable">https://www.pluralsight.com/guides/ruby-ruby-on-rails/creating-a-chat-using-rails-action-cable</a></p></blockquote>

<pre><code class="ruby">#Gemfile
gem 'redis'
</code></pre>

<pre><code class="ruby  ">#application.rb
module Default
  class Application &lt; Rails::Application
    config.action_cable.disable_request_forgery_protection = true 
    # config.action_cable.allowed_request_origins = ['http://192.168.0.200]
  end
end
</code></pre>

<pre><code class="ruby ">#config/routes.rb
mount ActionCable.server =&gt; '/cable'
</code></pre>

<p><code>rails g model message content:text name:string</code><br/>
<code>rake db:migrate</code><br/>
<code>rails g controller chats</code></p>

<pre><code class="ruby">#app/controllers/chats_controller.rb
def index
    @messages = Message.all
end
</code></pre>

<p>``` ruby</p>

<h1>app/views/rooms/index.erb</h1>

<div id="messages" class="messages">
  <%= render @messages %>
</div>


<p><form id="chat-from">
  <label>Say : </label>
  <input type="text" data-behavior="chat_speaker">
</form>
```</p>

<pre><code class="erb  ">#app/views/messages/_message.erb  
&lt;front id='message'&gt;&lt;b&gt;&lt;%= message.name %&gt;&lt;/b&gt; : &lt;font id="content"&gt;&lt;%= message.content %&gt;&lt;/font&gt;&lt;/font&gt;
</code></pre>

<p><code>rails g channel chat speak</code></p>

<pre><code class="ruby  ">#app/assets/javascripts/cable.coffee
//= require action_cable
//= require_self
//= require_tree ./channels
@App ||= {}
App.cable = ActionCable.createConsumer()
</code></pre>

<pre><code class="ruby  ">#app/views/layouts/application.html.erb
&lt;%= action_cable_meta_tag %&gt;
</code></pre>

<pre><code class="ruby">#app/channels/application_cable/connection.rb
module ApplicationCable
    class Connection &lt; ActionCable::Connection::Base
        identified_by :current_user

        def connect
            self.current_user = find_verified_user
            logger.add_tags 'ActionCable', current_user.email
        end

        protected

        def find_verified_user # this checks whether a user is authenticated with devise
            if verified_user = env['warden'].user
                verified_user
            else
                reject_unauthorized_connection
            end
        end
    end
end
</code></pre>

<pre><code class="ruby ">#app/channels/chat_channel.rb
class ChatChannel &lt; ApplicationCable::Channel
    def subscribed
        stream_from "chat_channel"
    end

    def unsubscribed
    end

    def speak(data)
        if not data['message'] == ""
            Message.create! content: data['message'], name: current_user.name
        end
    end
end
</code></pre>

<pre><code class="ruby">#app/assets/javascripts/channels/chat.coffee
App.chat = App.cable.subscriptions.create "ChatChannel",
    connected: -&gt;
        $('#messages').scrollTop( $('#messages')[0].scrollHeight )
  disconnected: -&gt;

  received: (data) -&gt;
    $('#messages').append(data['message'])
    $('#messages').scrollTop( $('#messages')[0].scrollHeight )

  speak: (message) -&gt;
    @perform 'speak', message: message

$(document).on 'keypress', '[data-behavior~=chat_speaker]', (event) -&gt;
  if event.keyCode is 13
    App.chat.speak event.target.value
    event.target.value = ""
    event.preventDefault()
</code></pre>

<p><code>rails g job MessageBroadcast</code></p>

<pre><code class="ruby">#app/jobs/message_broadcast_job.rb
class MessageBroadcastJob &lt; ApplicationJob
    queue_as :default

    def perform(message)
        ActionCable.server.broadcast 'chat_channel', message: render_message(message)
    end

    private
    def render_message(message)
        ApplicationController.renderer.render(partial: 'messages/message', locals: { message: message })
    end
end
</code></pre>

<pre><code class="ruby">#app/models/message.rb
class Message &lt; ApplicationRecord
    after_create_commit { MessageBroadcastJob.perform_later self }
end
</code></pre>

<pre><code class="scss">#scss
#messages {
  overflow: auto;
  position: relative;
  margin-left: 15px;
  height: 75vh;
  width: 90%;
  margin-bottom: 2vh;
}
#message {
  margin-left: 10%;
  font-size: 25px;
  line-height: 27px;
  position: relative;

}
#content {
  color: grey;
  font-size: 25px;
  line-height: 27px;
}

#chat-from {
  margin-left: 10%;
  margin-bottom:20px;
  position: relative;
}
</code></pre>
]]></content>
  </entry>
  
 </feed>
