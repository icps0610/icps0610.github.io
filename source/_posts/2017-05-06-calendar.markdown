---
layout: post
title: "calendar"
date: 2017-05-06 02:25:27 +0800
comments: true
categories: ruby
---
``` ruby
#!/usr/bin/env ruby
# encoding: utf-8
require 'rmagick'
require 'date'
class Calendar
	  
  def initialize
  	year  = Time.now.year
		month = Time.now.month
		@day   = Time.now.day
		@wday =  Time.new( year, month, 1, 0, 0, 0, "+00:00").wday
		@days =  Date.new( year, month, -1).day
		#location
		size = `identify base.jpg`.split(' ')[2].split('x')
		@x,@y = size[0].to_i-720 , size[1].to_i-1100
		#read
		@canvas = Magick::ImageList.new
		@canvas.read("base.jpg")
		#text setting
		@text_size = 32
		@text = Magick::Draw.new
		@text.pointsize = @text_size
		run
  end

  def calendar_title
		title = %w(Su Mo Tu We Th Fr Sa)
		title.each do |t|
			x = @x + @text_size*2*(title.index(t))
			@text.fill = 'black'
			@text.annotate(@canvas, 0,0, x, @y, t)
			@text.fill = 'grey'
			@text.annotate(@canvas, 0,0, x+5, @y, t)
		end
  end

	def text_one( color, text )
		x, y = @x + @text_size/2 + @text_size*2*(@x_day) , @y + @text_size*(@y_day + 1)
	  @text.fill = 'black'
	  @text.annotate(@canvas, 0, 0, x, y, "#{text}" )
	  @text.fill = "#{color}"
	  @text.annotate(@canvas, 0, 0, x+5, y, "#{text}" )
	end

	def text_two( color, text )
		x, y = @x + @text_size*2*(@x_day), @y + @text_size*(@y_day + 1)
	  @text.fill = 'black'
	  @text.annotate(@canvas, 0, 0, x, y, "#{text}" )
	  @text.fill = "#{color}"
	  @text.annotate(@canvas, 0, 0, x+5, y, "#{text}" )
	end

	def run
		calendar_title
		(0..@days-1).each do |d|
		  @x_day, @y_day = ( d + @wday ) % 7 , ( d + @wday ) / 7
		  if d > 8 and d+1 == @day
		    text_two( "red", d+1 )
		  elsif d <= 8 and d+1 == @day
		    text_one( "red", d+1 )
		  elsif d > 8
		    text_two( "white", d+1 )
		  else
		    text_one( "white", d+1 )
		  end
		end
		#output
		@canvas.write("cal.jpg")
	end
end

Calendar.new
```