---
layout: post
title: "calendar"
date: 2017-05-06 02:25:27 +0800
comments: true
categories: ruby
---

``` ruby
#!/usr/bin/env ruby
# encoding: utf-8
require 'rmagick'
require 'date'
class Calendar

  def initialize(file, output)
    today = Time.now
    year, month  = today.year, today.month
    @day  =  today.day
    @wday =  Time.new( year, month, 1, 0, 0, 0, "+00:00").wday
    @days =  Date.new( year, month, -1).day
    #location
    jpg = `identify #{file}`.split(' ')[2].split('x')
    @x,@y = jpg[0].to_i-720 , jpg[1].to_i-1100
    run(file, output)
  end

  def text( color, text, fixX )
    @x_day||=0 ;  @y_day||=-1
    x, y = @x + @sizeX*2*(@x_day) + fixX, @y + @sizeY*(@y_day + 1)
    @text.fill = 'black'
    @text.annotate(@canvas, 0, 0, x, y, "#{text}" )
    @text.fill = "#{color}"
    @text.annotate(@canvas, 0, 0, x-5, y, "#{text}" )
  end

  def calendar_title
    title = %w(SU MO TU WE TH FR SA)
    title.each do |t|
      fix =  @sizeX*2*(title.index(t)) + @sizeX/4
      text( "grey", t, fix )
    end
  end

  def calendar_days
    (0..@days-1).each do |d|
      @x_day = ( d + @wday ) % 7
      @y_day = ( d + @wday ) / 7
      d + 1 == @day ? color = "red" : color = "white"
      d > 8 ? fix = @sizeX/2 : fix = @sizeX
      text( color, d+1, fix )
    end
  end

  def run(file, output)
    @canvas = Magick::ImageList.new.read(file)
    @text = Magick::Draw.new
    @text.pointsize = @sizeX = 32
    @sizeY = 42
    calendar_title
    calendar_days
    #output
    @canvas.write(output)
  end
end

Calendar.new(ARGV[0],ARGV[1])

```