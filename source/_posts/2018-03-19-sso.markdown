---
layout: post
title: "sso"
date: 2018-03-19 22:28:58 +0800
comments: true
categories: ror
---

>> ref https://github.com/rishabhp/sso-rails-client
>> ref https://github.com/rishabhp/sso-rails-provider
```
#Gemfile


#config\router.rb
get '/users/auth/:provider/callback' => 'user_sessions#create'
get '/users/auth/failure' => 'user_sessions#failure'
match '/logout', :to => 'user_sessions#destroy', via: :all

#app/controllers/user_sessions_controller.rb
class UserSessionsController < ApplicationController
    def create
        @user = User.from_omniauth(request.env["omniauth.auth"])
        sign_in_and_redirect @user
    end
end


#config\initializers\devise.rb
config.omniauth :icps, Figaro.env.icps_app_id, Figaro.env.icps_secret, scope: 'email', info_fields: 'email, name'

#config\application.yml
icps_app_id: "id"
icps_secret: "secret"

#view.erb
<%= link_to "login", "/users/auth/icps" %>
```

```
#sso-rails-provider
ip = "192.168.0.201"
system "ifconfig eth0:0 #{ip}"
system "rails s -b #{ip} -p 3000"
```