---
layout: post
title: "ping_lan"
date: 2016-06-15 13:09:26 +0800
comments: true
categories: bat
---

<pre><code>@echo off
del ip.tmp 2> nul
del tmp.txt 2>nul
del log.txt 2>nul
SETLOCAL ENABLEDELAYEDEXPANSION
set l=192.168.0
for /l %%i in (1,1,254) do (
   echo ^@echo off > %SystemRoot%\TEMP\%%i.bat
   echo ping -n 1 -w 1000 %l%.%%i ^>nul >> %SystemRoot%\TEMP\%%i.bat
   echo if %%errorlevel%% == 0 echo %l%.%%i ^>^> ip.tmp >> %SystemRoot%\TEMP\%%i.bat
   echo exit >> %SystemRoot%\TEMP\%%i.bat
   start %SystemRoot%\TEMP\%%i.bat
)
echo 正在尋找有回應的主機
pause
echo 已找到有回應的主機
type ip.tmp
echo 分析主機名稱中..
for /l %%i in (1,1,254) do del %SystemRoot%\TEMP\%%i.bat
for /f %%i in (ip.tmp) do (
   ping -a -n 1 -w 100 %%i > tmp.txt
   set line=0
   for /f "tokens=2 delims= " %%j in (tmp.txt) do (
      set /a line=!line!+1
      if !line! == 1 echo %%i %%j & echo %%i %%j >>log.txt
   )
)
del ip.tmp 2> nul
del tmp.txt 2>nul
pause
</code></pre>